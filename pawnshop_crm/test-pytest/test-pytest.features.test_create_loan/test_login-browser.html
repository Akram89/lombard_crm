<html lang="en"><head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="/static/img/pawn-shop.png" type="image/png">
    <title>
    Lombard CRM
</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/foopicker.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">Lombard CRM</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <ul class="navbar-nav">
                
                
                
                <li class="nav-item">
                    <a class="nav-link" href="/loans/">Займы</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="/pledge_items/">Список залоговых имуществ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/operations/">Журнал операций</a>
                </li>
                
            </ul>
            <ul class="navbar-nav ml-auto">
                
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        admin
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        
                        <a class="dropdown-item" href="/accounts/1/">Личный кабинет</a>
                        <div class="dropdown-divider"></div>
                        
                        <a class="dropdown-item" href="/accounts/logout/">Выйти</a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

<section class="content">
    <div class="container content-container">
        
        <h5 class="content-heading">
    Выбор клиента
</h5>
        
    <div class="row justify-content-between">
        <div class="col-5">
            <div class="form-group">
                <input name="client_search_input" type="text" class="form-control" id="client_search_input" placeholder="Поиск клиента" style="">
                <div class="client-container-wrapper empty">
                    <div class="client-container"></div>
                    <div class="spinner-wrapper">
                        <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
                    </div>
                    <div class="no-content">
                        <p class="no-content-text">Ничего не найдено</p>
                    </div>
                </div>
                
                <div class="client-select-form-wrapper">
                    <div class="form-group">
                        <label>Клиент<span class="required-indicator"> *</span></label>
                    </div>
                    <div class="selected-client-item-wrapper">
                        <div class="no-content">
                            <p class="no-content-text">Клиент не выбран</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <a href="/clients/choose/" id="client_choose_btn" class="btn btn-dark btn-sm disabled">Выбрать клиента</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-4">
            <form action="/clients/create/" method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrfmiddlewaretoken" value="0xZJFTY2YG8UJjfSns2Z2y0d2OYUWOXuFR4qge3xaD74d5DOOaFIzMTBWH5XIk7w">
                


    <div class="form-group ">
        <label for="id_first_name">Имя<span class="required-indicator"> *</span></label>
        
            <input type="text" name="first_name" class="form-control" placeholder="Введите имя" required="" id="id_first_name">
        
    </div>

    <div class="form-group ">
        <label for="id_last_name">Фамилия<span class="required-indicator"> *</span></label>
        
            <input type="text" name="last_name" class="form-control" placeholder="Введите фамилию" required="" id="id_last_name">
        
    </div>

    <div class="form-group ">
        <label for="id_middle_name">Отчество</label>
        
            <input type="text" name="middle_name" class="form-control" placeholder="Введите отчество" id="id_middle_name">
        
    </div>

    <div class="form-group ">
        <label for="birth_date">Дата рождения<span class="required-indicator"> *</span></label>
        
            <input type="text" name="birth_date" placeholder="Введите дату рождения" id="birth_date" class="form-control" required="">
        
    </div>

    <div class="form-group ">
        <label for="id_location">Населенный пункт<span class="required-indicator"> *</span></label>
        
            <input type="text" name="location" class="form-control" placeholder="Введите название населенного пункта" required="" id="id_location">
        
    </div>

    <div class="form-group ">
        <label for="id_street">Улица<span class="required-indicator"> *</span></label>
        
            <input type="text" name="street" class="form-control" placeholder="Введите название улицы" required="" id="id_street">
        
    </div>

    <div class="form-group ">
        <label for="id_house_number">Номер дома<span class="required-indicator"> *</span></label>
        
            <input type="text" name="house_number" class="form-control" placeholder="Введите номер дома" required="" id="id_house_number">
        
    </div>

    <div class="form-group ">
        <label for="id_apartment_number">Номер квартиры</label>
        
            <input type="text" name="apartment_number" class="form-control" placeholder="Введите номер квартиры" id="id_apartment_number">
        
    </div>

    <div class="form-group ">
        <label for="id_actual_address">Фактический адрес проживания</label>
        
            <input type="text" name="actual_address" class="form-control" placeholder="Введите фактический адрес проживания" id="id_actual_address">
        
    </div>

    <div class="form-group ">
        <label for="id_birth_place">Место рождения</label>
        
            <input type="text" name="birth_place" class="form-control" placeholder="Введите место рождения" id="id_birth_place">
        
    </div>

    <div class="form-group ">
        <label for="id_phone">Номер телефона<span class="required-indicator"> *</span></label>
        
            <input type="number" name="phone" class="form-control" placeholder="Введите номер телефона" required="" id="id_phone">
        
    </div>

    <div class="form-group ">
        <label for="id_email">Email<span class="required-indicator"> *</span></label>
        
            <input type="email" name="email" class="form-control" placeholder="Введите email" required="" id="id_email">
        
    </div>

    <div class="form-group ">
        <label for="id_citizenship">Гражданство<span class="required-indicator"> *</span></label>
        
            <input type="text" name="citizenship" class="form-control" placeholder="Введите гражданство" required="" id="id_citizenship">
        
    </div>

    <div class="form-group ">
        <label for="id_files">Файлы</label>
        
            <input type="file" name="files" class="form-control-file" id="id_files">
        
    </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-dark btn-sm">Добавить клиента</button>
                </div>
            </form>
        </div>
    </div>
    <script>
    function setEmptyClientContainer () {
        const clientContainerWrapper = document.querySelector('.client-container-wrapper');
        clientContainerWrapper.classList.add('empty');
        clientContainerWrapper.classList.remove('loading');
    }
    function setLoadingClientContainer () {
        const clientContainerWrapper = document.querySelector('.client-container-wrapper');
        clientContainerWrapper.classList.remove('empty');
        clientContainerWrapper.classList.add('loading');
    }
    function setResultClientContainer () {
        const clientContainerWrapper = document.querySelector('.client-container-wrapper');
        clientContainerWrapper.classList.remove('empty');
        clientContainerWrapper.classList.remove('loading');
    }

    document.querySelector('#client_search_input').addEventListener('input', function (event) {
        setLoadingClientContainer();

        const url = '/clients/list/' + '?query=' + event.target.value;
        fetch(url).then(function (response) {
            if (response.ok)
                return response.json();
        }).then(function (response) {
            const clientContainer = document.querySelector('.client-container');
            clientContainer.innerHTML = '';
            if (response.clients.length !== 0) {
                setResultClientContainer();
                response.clients.map(function (client) {
                    const clientItem = document.createElement('div');
                    clientItem.classList.add('client-item');
                    clientItem.dataset.client_pk = client.pk;
                    clientItem.innerHTML = `
                        <div class="client-item-name">
                            <span>${client.last_name} ${client.first_name} ${client.middle_name === null ? '' : client.middle_name}</span>
                        </div>
                        <div class="client-item-detail-container">
                            <p class="client-item-detail"><span class="bold-text">• Дата рождения:</span> ${client.birth_date}</p>
                            <p class="client-item-detail"><span class="bold-text">• ИИН:</span> ${client.iin}</p>
                        </div>
                    `;
                    clientContainer.appendChild(clientItem);
                    clientItem.addEventListener('click', function () {
                        const selectClientWrapper = document.querySelector('.selected-client-item-wrapper');
                        selectClientWrapper.innerHTML = '';
                        const clientPk = clientItem.dataset.client_pk;
                        const clientItemClone = clientItem.cloneNode(true);
                        clientItemClone.classList.remove('client-item');
                        clientItemClone.classList.add('selected-client-item');
                        selectClientWrapper.appendChild(clientItemClone);

                        const clientChooseButton = document.querySelector('#client_choose_btn');
                        // clientChooseButton.href = '/clients/' + clientPk + '/choose/';
                        clientChooseButton.href = '/clients/choose/?client_pk=' + clientPk;
                        clientChooseButton.classList.remove('disabled');
                    });
                });
            }
            else {
                setEmptyClientContainer();
            }
        })
    });
</script>
    <script>
    function addClientElement(client) {
        document.querySelector('.selected-client-item-wrapper').innerHTML = '';
        const clientElement = document.createElement('div');
        clientElement.classList.add('selected-client-item');
        clientElement.innerHTML = `
                <div class="client-item-name">
                    <span>${ client.last_name } ${ client.first_name } ${client.middle_name === null ? '' : client.middle_name}</span>
                </div>
                <div class="client-item-detail-container">
                    <p class="client-item-detail"><span class="bold-text">• Дата рождения:</span> ${ client.birth_date }</p>
                    <p class="client-item-detail"><span class="bold-text">• ИИН:</span> ${ client.iin }</p>
                </div>
        `;
        document.querySelector('.selected-client-item-wrapper').appendChild(clientElement);
    }

    document.querySelectorAll('.client-item').forEach(function (clientItem) {
        clientItem.addEventListener('click', function () {
            const clientPk = clientItem.dataset.client_pk;
            const clientChooseButton = document.querySelector('#client_choose_btn');
            // clientChooseButton.href = '/clients/' + clientPk + '/choose/';
            clientChooseButton.href = '/clients/choose/?client_pk=' + clientPk;
            clientChooseButton.classList.remove('disabled');

            const url = '/clients/' + '?client_pk=' + clientPk;
            fetch(url).then(function (response) {
                if (response.ok)
                    return response.json()
            }).then(function (response) {
                addClientElement(response.client);
            });
        });
    });
</script>
    
<script src="/static/js/foopicker.js"></script>
<script>
    const foopicker = new FooPicker({
        id: 'birth_date',
        dateFormat: 'dd.MM.yyyy'
    });
</script>

    </div>
</section><div id="foopicker-birth_date"></div>
<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body></html>